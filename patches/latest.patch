--- /mnt/data/ozrepo/Ozonator-main/electron/main/index.ts	2026-02-25 11:19:36.000000000 +0000
+++ /mnt/data/workrepo2/electron/main/index.ts	2026-02-25 12:56:46.632421160 +0000
@@ -369,9 +369,10 @@
     let placementCacheKept = false
     try {
       const productsForStore = dbGetProducts(secrets.clientId)
-      const skuList = Array.from(new Set(productsForStore.map((p) => String(p.sku ?? '').trim()).filter(Boolean)))
+      const ozonSkuList = Array.from(new Set(productsForStore.map((p) => String(p.sku ?? '').trim()).filter(Boolean)))
+      const sellerSkuList = Array.from(new Set(productsForStore.map((p) => String(p.offer_id ?? '').trim()).filter(Boolean)))
 
-      if (skuList.length > 0) {
+      if (ozonSkuList.length > 0 || sellerSkuList.length > 0) {
         const warehouses = await ozonWarehouseList(secrets)
         if (!Array.isArray(warehouses) || warehouses.length === 0) {
           placementSyncError = 'Ozon не вернул список складов; локальные данные по складам/зонам сохранены без перезаписи.'
@@ -385,24 +386,56 @@
             seller_sku?: string | null
             placement_zone?: string | null
           }> = []
+          const placementRowKeys = new Set<string>()
           let placementApiCallCount = 0
 
+          const appendPlacementRows = (
+            warehouseId: number,
+            warehouseName: string | null,
+            zones: Array<{
+              sku: string
+              ozon_sku?: string | null
+              seller_sku?: string | null
+              placement_zone: string | null
+            }>
+          ) => {
+            for (const z of zones) {
+              const rowKey = [
+                String(warehouseId),
+                String(z.ozon_sku ?? ''),
+                String(z.seller_sku ?? ''),
+                String(z.placement_zone ?? ''),
+              ].join('::')
+              if (placementRowKeys.has(rowKey)) continue
+              placementRowKeys.add(rowKey)
+
+              allPlacementRows.push({
+                warehouse_id: warehouseId,
+                warehouse_name: warehouseName,
+                sku: z.sku,
+                ozon_sku: z.ozon_sku ?? null,
+                seller_sku: z.seller_sku ?? null,
+                placement_zone: z.placement_zone ?? null,
+              })
+            }
+          }
+
           for (const wh of warehouses) {
             const wid = Number(wh.warehouse_id)
             if (!Number.isFinite(wid)) continue
-            for (const part of chunk(skuList, 500)) {
+
+            for (const part of chunk(ozonSkuList, 500)) {
+              placementApiCallCount += 1
+              const zones = await ozonPlacementZoneInfo(secrets, { warehouseId: wid, skus: part })
+              appendPlacementRows(wid, wh.name ?? null, zones)
+            }
+
+            // Для части кабинетов/ответов Ozon зоны размещения возвращаются только по SKU продавца.
+            // Делаем дополнительный проход по offer_id (seller SKU) и дедуплицируем строки.
+            for (const part of chunk(sellerSkuList, 500)) {
               placementApiCallCount += 1
               const zones = await ozonPlacementZoneInfo(secrets, { warehouseId: wid, skus: part })
-              for (const z of zones) {
-                allPlacementRows.push({
-                  warehouse_id: wid,
-                  warehouse_name: wh.name ?? null,
-                  sku: z.sku,
-                  ozon_sku: z.ozon_sku ?? null,
-                  seller_sku: z.seller_sku ?? null,
-                  placement_zone: z.placement_zone ?? null,
-                })
-              }
+              appendPlacementRows(wid, wh.name ?? null, zones)
             }
           }
 
--- /mnt/data/ozrepo/Ozonator-main/electron/main/ozon.ts	2026-02-25 11:19:36.000000000 +0000
+++ /mnt/data/workrepo2/electron/main/ozon.ts	2026-02-25 12:55:31.979807036 +0000
@@ -917,8 +917,17 @@
       obj?.offer_id ??
       obj?.offerId
 
-    const ozonSku = (typeof ozonSkuRaw === 'string' || typeof ozonSkuRaw === 'number') ? String(ozonSkuRaw).trim() : ''
-    const sellerSku = (typeof sellerSkuRaw === 'string' || typeof sellerSkuRaw === 'number') ? String(sellerSkuRaw).trim() : ''
+    let ozonSku = (typeof ozonSkuRaw === 'string' || typeof ozonSkuRaw === 'number') ? String(ozonSkuRaw).trim() : ''
+    let sellerSku = (typeof sellerSkuRaw === 'string' || typeof sellerSkuRaw === 'number') ? String(sellerSkuRaw).trim() : ''
+
+    // В ответах Ozon поле `sku` иногда приходит как SKU продавца (offer_id / seller_sku).
+    // Если отдельного seller_sku нет и `sku` нечисловой — сохраняем его как seller_sku,
+    // чтобы вкладка «Остатки» смогла сматчить размещение с товаром по offer_id.
+    if (!sellerSku && ozonSku && !/^\d+$/.test(ozonSku)) {
+      sellerSku = ozonSku
+      ozonSku = ''
+    }
+
     const canonicalSku = ozonSku || sellerSku
     if (!canonicalSku) continue
 
--- /mnt/data/ozrepo/Ozonator-main/src/renderer/src/ui/pages/ProductsPage.tsx	2026-02-25 11:19:36.000000000 +0000
+++ /mnt/data/workrepo2/src/renderer/src/ui/pages/ProductsPage.tsx	2026-02-25 12:56:25.460525776 +0000
@@ -550,31 +550,19 @@
           if (colId === 'is_visible') return visibilityText(p)
           if (colId === 'brand') return (p.brand && String(p.brand).trim()) ? String(p.brand).trim() : 'Не указан'
           if (colId === 'name') return (p.name && String(p.name).trim()) ? String(p.name).trim() : 'Без названия'
-    if (colId === 'ozon_sku') {
-      const v = p.ozon_sku ?? p.sku
-      return (v == null || String(v).trim() === '') ? '-' : String(v)
-    }
-    if (colId === 'seller_sku') {
-      const v = p.seller_sku ?? p.offer_id
-      return (v == null || String(v).trim() === '') ? '-' : String(v)
-    }
-    if (colId === 'fbo_sku' || colId === 'fbs_sku') {
-      const v = (p as any)[colId]
-      return (v == null || String(v).trim() === '') ? '-' : String(v)
-    }
           if (colId === 'ozon_sku') {
-      const v = p.ozon_sku ?? p.sku
-      return (v == null || String(v).trim() === '') ? '-' : String(v)
-    }
-    if (colId === 'seller_sku') {
-      const v = p.seller_sku ?? p.offer_id
-      return (v == null || String(v).trim() === '') ? '-' : String(v)
-    }
-    if (colId === 'fbo_sku' || colId === 'fbs_sku') {
-      const v = (p as any)[colId]
-      return (v == null || String(v).trim() === '') ? '-' : String(v)
-    }
-    if (colId === 'photo_url') return ''
+            const v = p.ozon_sku ?? p.sku
+            return (v == null || String(v).trim() === '') ? '-' : String(v)
+          }
+          if (colId === 'seller_sku') {
+            const v = p.seller_sku ?? p.offer_id
+            return (v == null || String(v).trim() === '') ? '-' : String(v)
+          }
+          if (colId === 'fbo_sku' || colId === 'fbs_sku') {
+            const v = (p as any)[colId]
+            return (v == null || String(v).trim() === '') ? '-' : String(v)
+          }
+          if (colId === 'photo_url') return ''
           return toText((p as any)[colId])
         })
         .join(' ')
